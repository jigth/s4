[tox]
envlist = python3, pypy3

[testenv]
usedevelop = True
passenv = *
whitelist_externals = bash
commands =
    bash -c 'if [   -n "$SERIAL"  ]; then S4_NO_LOCAL=true py.test -svx --tb native                 tests/test_server.py; fi'
    bash -c 'if [ ! -n "$SERIAL"  ]; then S4_NO_LOCAL=true py.test -svx --tb native -n auto --boxed tests/test_server.py; fi'
    bash -c 'if [   -n "$SERIAL"  ]; then                  py.test -svx --tb native                 tests/test_server.py; fi'
    bash -c 'if [ ! -n "$SERIAL"  ]; then                  py.test -svx --tb native -n auto --boxed tests/test_server.py; fi'
    bash -c 'if [   -n "$CLUSTER" ]; then py.test -svx --tb native                 tests/test_cluster.py; fi'
deps =
    -r requirements.txt
    git+https://github.com/nathants/cli-aws
    git+https://github.com/nathants/py-shell
    requests
    pytest
    pytest-xdist
